/* ------------------------------------------------------------------------------------------------------------------------------------------------ */
/* Imports */
/* ------------------------------------------------------------------------------------------------------------------------------------------------ */
import { serverSideTranslations } from "next-i18next/serverSideTranslations";
import api from "@classes/api";
/* ------------------------------------------------------------------------------------------------------------------------------------------------ */
/* Types */
/* ------------------------------------------------------------------------------------------------------------------------------------------------ */
import type { GetServerSideProps } from "next";
/* ------------------------------------------------------------------------------------------------------------------------------------------------ */
/* Scripts */
/* ------------------------------------------------------------------------------------------------------------------------------------------------ */
import { extractId } from "@scripts/extractId";
/* ------------------------------------------------------------------------------------------------------------------------------------------------ */
/* Page */
/* ------------------------------------------------------------------------------------------------------------------------------------------------ */
import Deals from "@pages/deals";
/* ------------------------------------------------------------------------------------------------------------------------------------------------ */
/* Server Side Props */
/* ------------------------------------------------------------------------------------------------------------------------------------------------ */
const getServerSideProps: GetServerSideProps = async ({ res, query, locale, locales }) => {
	res.setHeader("Cache-Control", "public, s-maxage=86400, stale-while-revalidate=59");
	const i18next = require("@project/next-i18next.config");
    const { category, subcategory, page } = query;
    const searchEngineFilters = {
        categories: 5,
        subcategories1: (category) ? extractId(category) : null,
        subcategories2: (subcategory) ? extractId(subcategory) : null,
        page: page || 1
    };
	return {
		props: {
			...(await serverSideTranslations(locale || "fr", [ "deals", "navbar", "footer", "common" ], i18next)),
			locales,
            filters: await api.getPublicCommons("next", "Landing", locale),
            deals: await api.searchEngine("opportunite", searchEngineFilters, null, null, null, locale)
		}
	};
};
/* ------------------------------------------------------------------------------------------------------------------------------------------------ */
/* Exports */
/* ------------------------------------------------------------------------------------------------------------------------------------------------ */
export default Deals;
export { getServerSideProps };